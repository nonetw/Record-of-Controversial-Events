<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>Just Records</title>
  <!-- DataTables CSS -->
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    img { max-width: 150px; margin: 5px; }
    .tag {
      display: inline-block;
      background-color: #eee;
      border-radius: 4px;
      padding: 2px 6px;
      margin: 2px;
      font-size: 12px;
    }
    .filter-container { margin-bottom: 15px; }
  </style>
</head>
<body>
  <h1>Just Records</h1>

  <!-- 標籤篩選複選框 -->
  <!--
  <div class="filter-container">
    <label><input type="checkbox" class="tagFilter" value="食安"> 食安</label>
    <label><input type="checkbox" class="tagFilter" value="勞工"> 勞工</label>
    <label><input type="checkbox" class="tagFilter" value="中國"> 中國</label>
  </div>
  -->
  
  
  
<table id="eventTable" class="display">
<thead>
  <tr>
    <th>日期</th>
    <th>名稱</th>
    <th>標籤</th>
    <th>事件簡述</th>
    <th>網址</th>
    <th>紀錄截圖</th>
  </tr>
  <tr>
    <th></th>
    <th><select><option value="">全部</option></select></th>
    <th><select><option value="">全部</option></select></th>
    <th></th>
    <th></th>
    <th></th>
  </tr>
</thead>

  <tbody>
    <!-- 這裡會由 JS 插入 events.html 的內容 -->
  </tbody>
</table>



<!-- jQuery + DataTables JS -->
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>

<script>
$(document).ready(function() {
  // 先載入 events.html 的資料
  fetch('partials/events.html')
    .then(response => response.text())
    .then(html => {
      // 把生成的 <tr> 插入到 <tbody>
      document.querySelector('#eventTable tbody').innerHTML = html;

      // 初始化 DataTables
      var table = $('#eventTable').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
        pageLength: 100,
        lengthMenu: [10, 20, 50, 100]
      });

      // 建立下拉選單
      $('#eventTable thead tr:eq(1) th').each(function(i) {
        var select = $('select', this);
        if (select.length) {
          if (i === 2) { // 標籤欄位 (注意欄位索引要對齊)
            table.column(i).nodes().to$().each(function() {
              $(this).find('.tag').each(function() {
                var tagText = $(this).text().trim();
                if (tagText && select.find("option[value='" + tagText + "']").length === 0) {
                  select.append('<option value="' + tagText + '">' + tagText + '</option>');
                }
              });
            });
          } else {
            table.column(i).nodes().to$().each(function() {
              var text = $(this).text().trim();
              if (text && select.find("option[value='" + text + "']").length === 0) {
                select.append('<option value="' + text + '">' + text + '</option>');
              }
            });
          }

          // 綁定篩選事件
          select.on('change', function() {
            var val = $(this).val();
            if (val) {
              table.column(i).search(val).draw();
            } else {
              table.column(i).search('').draw();
            }
          });
        }
      });
    })
    .catch(err => console.error("載入 events.html 失敗:", err));
});
</script>
